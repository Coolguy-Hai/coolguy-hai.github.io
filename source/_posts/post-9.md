---
title: 【Linux内核学习】《Linux内核设计与分析》第四章-进程调度
date: 2021-06-23 15:14:11
tags: 读书笔记
---

进程调度程序可看作在可运行态进程之间调配有限的处理器时间资源的内核子系统。

## 多任务

多任务操作系统就是能同时并发执行多个进程的操作系统，通常分为两类：抢占式与非抢占式。在抢占式的操作系统中，进程何时停止运行、何时得到资源都是由调度程序来决定。

## Linux的进程调度

在早期，Linux的进程调度程序近乎原始，无法胜任许多的调度任务。在2.5版本中，Linux基于静态时间片算法和针对每一处理器的运行队列的引入了O(1)调度算法，但这对于一些交互式程序仍存在一些不足，不能及时的对其做出响应。因此，在2.6版本中，Linux又引入了完全公平调度算法（CFS）

## 策略

#### I/O消耗性和处理器消耗性进程

I/O消耗性的进程往往阻塞于I/O操作，而处理器消耗性进程则把大部分时间用于计算当中。调度程序的任务就是在这两者之间寻找平衡：进程响应迅速和最大系统利用率。

#### 进程优先级

调度算法中最基本的一类就是基于优先级调度。

在Linux中采用了两种优先级范围，第一种是nice值，nice值越高优先级越低。第二种是实时优先级，可以动态配置，范围为0到99。与nice值相反，高实时优先级意味着进程的优先级也越高。任何实时进程的优先级都高于普通的进程。

#### 时间片

时间片是一个数值，它规定了一个进程在被抢占前所能持续运行的时间。但时间片大小的规定并不简单，因为较大的时间片会导致系统的交互性能较差，而较小的时间片会明显增加用于系统切换的时间，而且也降低高速缓存的命中率。

## Linux调度算法

#### 调度器类

Linux调度器是以模块方式提供的，这样做允许不同类型的进程可以有针对性地选择调度算法。

调度器会根据调度类的优先级遍历不同调度类，再去选择执行下面哪个进程。其中完全公平调度是一个针对普通进程的调度类。

#### Unix系统中进程调度

在Unix系统上，优先级往往以nice值的形式输出给用户空间，这在实现上存在着一些问题。

1. 若要将nice值映射为时间片，则必然需要将nice值对应到处理器的绝对时间，这样将导致进程的切换无法最优化执行。如此分配将使得低优先级的进程获得较小的时间片，高优先级的进程获得较大的时间片。而事实上，低优先级的进程往往是需要进行大量计算的后台进程，普通优先级的进程则更多是前台用户任务，如此分配时间片显然不算合理。
2. 若按前面提到的分配方式，还存在另一个问题。假设有两个进程，优先级分别为0和1，若以绝对方式分配时间片，则分别获得100ms和95ms的时间片，几乎没有差别。而如果优先级分别为18和19，则分别获得10ms和5ms的时间片，相差了整整一倍。也就是说，把进程的nice值减少1所带来的效果极大地取决于原始优先级。
3. 如果执行nice值到时间片的映射，我们还需要能分配一个绝对时间片，而且这个时间片还必须在内核的测试范围之内。而这意味着时间片必须是定时器节拍的整数倍，也就是10ms和1ms的倍数。

#### 公平调度

